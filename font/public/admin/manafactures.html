<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../fontawesome-free-6.4.2-web/css/all.min.css">
	<link rel="stylesheet" href="../../source/stylesheet/root.css">
	<link rel="stylesheet" href="../../source/stylesheet/admin/admin.css">
	<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
	crossorigin="anonymous"></script>
	<script src="../angular/angularjs.js"></script>
	<script src="../../source/script/admin/admin.js"></script>
	<title>Document</title>
</head>

<body ng-app="AppBanHang" ng-controller="MainCtrl">
	<section id="sidebar">
		<a href="#" class="brand">
			<img src="../images/logo.png" alt="" class="img-icon">
			<img src="../images/single-logo.png" alt="" class="single-img-icon">
		</a>
		<ul class="side-menu top">
			<li>
				<a href="./admin.html">
					<i class="fa-solid fa-user"></i>
					<span class="text">Managerment</span>
				</a>
			</li>
			<li>
				<a href="./products.html">
					<i class="fa-solid fa-box"></i>
					<span class="text">Products</span>
				</a>
			</li>
			<li class="active">
				<a href="./manafactures.html">
					<i class="fa-solid fa-industry"></i>
					<span class="text">Manafactures</span>
				</a>
			</li>
			<li>
				<a href="./customers.html">
					<i class="fa-solid fa-users"></i>
					<span class="text">Customers</span>
				</a>
			</li>
			<li>
				<a href="./bill.html">
					<i class="fa-solid fa-file-invoice"></i>
					<span class="text">Bills</span>
				</a>
			</li>
			<li>
				<a href="./statistical.html">
					<i class="fa-solid fa-chart-simple"></i>
					<span class="text">Statistical</span>
				</a>
			</li>
			<li>
				<a href="./receipt.html">
					<i class="fa-solid fa-file-invoice-dollar"></i>
					<span class="text">Receipts</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class="fa-solid fa-wrench"></i>
					<span class="text">Settings</span>
				</a>
			</li>
			<li>
				<a href="./login.html" class="logout">
					<i class="fa-solid fa-right-from-bracket"></i>
					<span onclick="logOut()" class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class="fa-solid fa-bars"></i>
			<a href="#" class="nav-link">Categories</a>
			<form class="form-search" action="#">
				<div class="form-input" style="width: 400px">
					<input ng-model="TextSearch" type="search" placeholder="Search..." >
					<button ng-click="SearchByhdbMoTa()" type="submit" class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a>
			<a href="#" class="profile">
				<img src="../anh_nguoi.png">
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<div class="submit">
					<div class="submit__button">
						<button ng-click="Edit(x.nId)">Lưu</button>
					</div>
				</div>
				<div class="section__parents-button">
					<div class="section__button">
						<button ng-click="Add()" type="submit">Thêm</button>
					</div>
					<!-- <div class="section__button">
						<button>Sửa</button>
					</div>
					<div class="section__button">
						<button>Xoá</button>
					</div> -->
				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>

			<!-- RIGHT CONTENT -->
			<!-- ENTER CONTENT -->
			<div class="right-section">
				<form>
					<div class="section-big-parents border-right">
						<div class="section__parents-label">
							<div class="section__box">
								<label for="">Nhập mã nhà sản xuất:</label><br>
								<input id="nId" name="nId" ng-model="nId" class="section__input" type="text"><br>
							</div>
							<div class="section__box">
								<label for="">Nhập tên nhà sản xuất:</label><br>
								<input id="nTen" name="nTen" ng-model="nTen" class="section__input" type="text"><br>
							</div>
							<div class="section__box">
								<label for="">Nhập số điện thoại:</label><br>
								<input id="nSdt" name="nSdt" ng-model="nSdt" class="section__input" type="text"><br>
							</div>
						</div>
						<div class="section__parents-label">
							<div class="section__box">
								<label for="">Nhập địa chỉ:</label><br>
								<input id="nDiaChi" name="nDiaChi" ng-model="nDiaChi" class="section__input" type="text"><br>
							</div>
							<div class="section__box">
								<label for="">Nhập email:</label><br>
								<input id="nEmail" name="nEmail" ng-model="nEmail" class="section__input" type="text"><br>
							</div>
						</div>	
					</div>
				</form>

				<!-- TABLE CONTENT -->
				<table id="table" class="table-box border-right table-content-box">
					<tr class="colum">
						<th class="colum-title one">Mã</th>
						<th class="colum-title">Nhà sản xuất</th>
						<th class="colum-title">Số điện thoại</th>
						<th class="colum-title">Địa chỉ</th>
						<th class="colum-title">Email</th>
						<th class="colum-title second">Chức năng</th>
					</tr>
					<tr ng-repeat="x in listManafacture.data" class="colum-content-box">
						<th class="colum-content">{{x.nId}}</th>
						<th class="colum-content">{{x.nTen}}</th>
						<th class="colum-content">{{x.nSdt}}</th>
						<th class="colum-content">{{x.nDiaChi}}</th>
						<th class="colum-content">{{x.nEmail}}</th>
						<th class="colum-content">
							<!-- nut Sua -->
							<i id="Edit" onclick="editClick()" class="fa-regular fa-pen-to-square"></i>
							<!-- nut Xoa -->
							<i id="Delete" ng-click="Delete(x.nId)" class="fa-solid fa-trash-can"></i>
						</th>
					</tr>
				</table>

				<div class="navigation"></div>
			</div>
		</main>
	</section>

	<script>
		const showEdit = () => {
			var edit = document.querySelector('.submit');
			edit.classList.add('show-button-edit');
		} 
		
		const editClick = () => {
			showEdit();
			var table = document.getElementById('table');    
			for(var i = 1; i < table.rows.length; i++)
			{
					table.rows[i].onclick = function()
					{
								document.getElementById("nId").value = this.cells[0].innerHTML;
								document.getElementById("nTen").value = this.cells[1].innerHTML;
								document.getElementById("nSdt").value = this.cells[2].innerHTML;
								document.getElementById("nDiaChi").value = this.cells[3].innerHTML;
								document.getElementById("nEmail").value = this.cells[4].innerHTML;
					};
			}
		}

		var app = angular.module('AppBanHang', [])
		app.controller('MainCtrl', function ($scope, $http, $window) {
			$scope.listManafacture = [];
			
			$scope.Add = () => {
				const obj = {
					"nTen": $scope.nTen,
					"nSdt": $scope.nSdt,
					"nDiaChi": $scope.nDiaChi,
					"nEmail": $scope.nEmail}
				$http({
					method: "POST",
					url: "https://localhost:44390/api/Manafacture/create-manafacture",
					data: obj,
					dataType: 'json',
					headers: { "Content-Type": "application/json" }
				}).then(function (response) {
					alert('Sản phẩm đã được thêm thành công');
					$scope.listManafacture.push(response.data);
					location.reload();
				}), function () {
					alert('Vui lòng thử lại!')
				};
			};
			

			$scope.Edit = function (nId) {
				const obj = {
						"nId": $scope.nId,
						"nTen": $scope.nTen,
						"nSdt": $scope.nSdt,
						"nDiaChi": $scope.nDiaChi,
						"nEmail": $scope.nEmail
				};
				$http({
						method: "PUT",
						url: "https://localhost:44390/api/Manafacture/update-manafacture",
						data: obj,
						dataType: 'json',
						headers: { "Content-Type": "application/json" }
				}).then(function (response) {
						alert('Sản phẩm đã được cập nhật thành công');
						$scope.listManafacture[$scope.editIndex] = response.data;
						location.reload();
				}, function () {
						alert('Vui lòng thử lại!');
				});
			};

			$scope.Delete = function (nId) {
				if(confirm('Bạn có muốn xoá không?'))
				{
					$http({
						method: "DELETE",
						url: 'https://localhost:44390/api/Manafacture/delete-manafacture?model=' + nId,
						dataType: 'json',
						headers: { "Content-Type": "application/json" }
					}).then(function () {
						$scope.Search({
							page: pageIndex,
							pageSize: 6
						})
						alert('Sản phẩm đã được xóa thành công');
					}, function () {
						alert('Không thể xóa sản phẩm. Vui lòng thử lại!');
					});
				}
			};
			
			let pageIndex = 1;
			$scope.Search = function (data) {
				$http({
					method: 'POST',
					data,
					url: 'https://localhost:44390/api/Manafacture/search-manafacture',
				}).then(function (response) {
					$scope.listManafacture = response.data;
					var total = Number(response.data.totalItems);
					reload(total);
				});
			};

			$scope.Search({
				page: pageIndex,
				pageSize: 6
			})

			$scope.SearchByhdbMoTa = function() {
				$scope.Search({
					page: pageIndex,
					pageSize: 6,
					ten: $scope.TextSearch
				})
			}

			function reload(total) {
				const totalPages = Math.ceil(total / 6);
				document.querySelector('.navigation').innerHTML = '';
				for (let index = 0; index < totalPages; index++) {
					document.querySelector('.navigation').innerHTML += 
					`<button data-id="${index + 1}" class="btn-primary">${index + 1}</button>`;
				}
				const btnNavigation = document.querySelectorAll('button[data-id]');
				console.log(btnNavigation);
				btnNavigation.forEach((item) => (
					item.onclick = () =>
						$scope.Search({
							page: item.dataset.id,
							pageSize: 6,
						})),
				);
			}
		});
	</script>
</body>
</html>